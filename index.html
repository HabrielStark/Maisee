<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Summer Goal Animation</title>
<style>
  :root{
    --bg:#e8f3ff;
    --ink:#0e0e13;
    --ball:#ffffff;
    --trail:#ffffff;
    --heart:#ff93ba;
    --shadow:rgba(10,16,30,.18);
    --trail-ink:#2a3442;
  }
  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    overflow:hidden;
    cursor: none;
  }
  .wrap{
    position:relative;
    width:100%;
    height:100%;
  }
  canvas{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    display:block;
  }
  .overlay{
    position:absolute;
    inset:0;
    pointer-events:none;
  }
  .svg-ball{
    position:absolute;
    width:84px; height:84px;
    transform:translate(-50%,-50%);
    filter: drop-shadow(0 10px 16px var(--shadow));
    opacity:0.98;
    will-change: transform, left, top;
  }
  .svg-ball path, .svg-ball circle{
    stroke: var(--trail-ink);
    stroke-width:1.2;
  }
  .ball-fill{
    fill:var(--ball);
  }
  .signature{
    position:absolute;
    left:50%;
    top:67%;
    transform:translate(-50%,-50%);
    color:var(--ink);
    font-size: clamp(18px, 4vw, 42px);
    letter-spacing:0.3px;
    opacity:0;
    text-align:center;
    white-space:pre-wrap;
    line-height:1.12;
    text-shadow: 0 1px 0 rgba(255,255,255,0.35);
    will-change: opacity, transform;
    width: 90%;
    max-width: 800px;
  }
  .heart{
    position:absolute;
    width:52px; height:52px;
    transform:translate(-50%,-50%) scale(0.2);
    opacity:0;
    filter: drop-shadow(0 10px 16px var(--shadow));
    will-change: transform, left, top, opacity;
  }
  .heart path{
    fill:var(--heart);
    stroke:rgba(255,255,255,.5);
    stroke-width:0.75;
  }
  .credit{
    position:absolute;
    bottom:10px; left:50%;
    transform:translateX(-50%);
    font-size:12px;
    opacity:.45;
    letter-spacing:.2px;
  }
  
  /* Custom cursor styles */
  .custom-cursor{
    position:fixed;
    width:20px; height:20px;
    pointer-events:none;
    z-index:9999;
    transform:translate(-50%,-50%);
    filter: drop-shadow(0 2px 4px rgba(255,147,186,0.3));
    will-change: transform;
    transition: transform 0.1s ease-out;
  }
  .custom-cursor path{
    fill:#ff93ba;
    stroke:rgba(255,255,255,0.8);
    stroke-width:0.5;
  }
  
  /* Cursor trail canvas */
  #cursorTrailCanvas{
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    pointer-events:none;
    z-index:9998;
  }
</style>

<script type="importmap">
{
  "imports": {}
}
</script>
</head>
<body>
  <!-- Custom cursor trail canvas -->
  <canvas id="cursorTrailCanvas"></canvas>
  
  <!-- Custom cursor -->
  <svg class="custom-cursor" id="customCursor" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 21s-5.2-3.46-8.04-6.3C1.9 12.64 1.5 9.7 3.35 7.84c1.63-1.64 4.38-1.64 6.01 0L12 10.49l2.64-2.65c1.63-1.64 4.38-1.64 6.01 0 1.85 1.86 1.45 4.8-.61 6.86C17.2 17.54 12 21 12 21z"/>
  </svg>

  <div class="wrap">
    <canvas id="scene"></canvas>

    <!-- Soccer ball SVG -->
    <svg id="ball" class="svg-ball" viewBox="0 0 24 24" aria-label="soccer ball">
      <defs>
        <radialGradient id="gShade" cx="30%" cy="30%" r="75%">
          <stop offset="0%" stop-color="#ffffff"/>
          <stop offset="70%" stop-color="#f1f4f8"/>
          <stop offset="100%" stop-color="#e7ecf3"/>
        </radialGradient>
      </defs>
      <circle class="ball-fill" cx="12" cy="12" r="9" fill="url(#gShade)"></circle>
      <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" />
      <path d="M12 7l4.76 3.45l-1.76 5.55h-6l-1.76 -5.55z" />
      <path d="M12 7v-4m3 13l2.5 3m-.74 -8.55l3.74 -1.45m-11.44 7.05l-2.56 2.95m.74 -8.55l-3.74 -1.45" />
    </svg>

    <!-- Heart SVG that appears after morph -->
    <svg id="heart" class="heart" viewBox="0 0 24 24" aria-label="heart">
      <path d="M12 21s-5.2-3.46-8.04-6.3C1.9 12.64 1.5 9.7 3.35 7.84c1.63-1.64 4.38-1.64 6.01 0L12 10.49l2.64-2.65c1.63-1.64 4.38-1.64 6.01 0 1.85 1.86 1.45 4.8-.61 6.86C17.2 17.54 12 21 12 21z"/>
    </svg>

    <!-- Signature text -->
    <div id="signature" class="signature" aria-label="signature"></div>

    <div class="overlay"></div>
    <div class="credit">Made with care • No external assets</div>
  </div>

<script type="module">
// Custom cursor system
const cursorEl = document.getElementById('customCursor');
const cursorTrailCanvas = document.getElementById('cursorTrailCanvas');
const cursorCtx = cursorTrailCanvas.getContext('2d');
const cursorDpr = Math.max(1, window.devicePixelRatio || 1);

let cursorX = 0, cursorY = 0;
let cursorTrail = [];

function setupCursorTrail(){
  cursorTrailCanvas.width = window.innerWidth * cursorDpr;
  cursorTrailCanvas.height = window.innerHeight * cursorDpr;
  cursorTrailCanvas.style.width = window.innerWidth + 'px';
  cursorTrailCanvas.style.height = window.innerHeight + 'px';
  cursorCtx.setTransform(cursorDpr,0,0,cursorDpr,0,0);
}

function updateCursor(e){
  cursorX = e.clientX;
  cursorY = e.clientY;
  cursorEl.style.left = cursorX + 'px';
  cursorEl.style.top = cursorY + 'px';
  
  // Add point to trail
  cursorTrail.push({
    x: cursorX,
    y: cursorY,
    time: performance.now(),
    opacity: 1
  });
  
  // Limit trail length
  if (cursorTrail.length > 50) {
    cursorTrail.shift();
  }
}

function drawCursorTrail(){
  cursorCtx.clearRect(0, 0, cursorTrailCanvas.width / cursorDpr, cursorTrailCanvas.height / cursorDpr);
  
  if (cursorTrail.length < 2) return;
  
  const now = performance.now();
  
  // Remove old points and update opacity
  cursorTrail = cursorTrail.filter(point => {
    const age = now - point.time;
    if (age > 1000) return false; // Remove after 1 second
    point.opacity = Math.max(0, 1 - age / 1000);
    return true;
  });
  
  // Draw trail
  cursorCtx.lineCap = 'round';
  cursorCtx.lineJoin = 'round';
  
  for (let i = 1; i < cursorTrail.length; i++){
    const prev = cursorTrail[i-1];
    const curr = cursorTrail[i];
    const avgOpacity = (prev.opacity + curr.opacity) / 2;
    
    if (avgOpacity <= 0.01) continue;
    
    const gradient = cursorCtx.createLinearGradient(prev.x, prev.y, curr.x, curr.y);
    gradient.addColorStop(0, `rgba(255, 147, 186, ${prev.opacity * 0.6})`);
    gradient.addColorStop(1, `rgba(255, 147, 186, ${curr.opacity * 0.6})`);
    
    cursorCtx.strokeStyle = gradient;
    cursorCtx.lineWidth = 3 * avgOpacity;
    cursorCtx.beginPath();
    cursorCtx.moveTo(prev.x, prev.y);
    cursorCtx.lineTo(curr.x, curr.y);
    cursorCtx.stroke();
  }
}

// Main animation elements
const canvas = document.getElementById('scene');
const ctx = canvas.getContext('2d');
const dpr = Math.max(1, window.devicePixelRatio || 1);

const ballEl = document.getElementById('ball');
const heartEl = document.getElementById('heart');
const sigEl = document.getElementById('signature');

const MESSAGE = '"Meeting you was the best goal of my summer, Maisee ⚽️"';

let W=0,H=0;
function resize(){
  const {clientWidth, clientHeight} = canvas;
  W = canvas.width = Math.floor(clientWidth * dpr);
  H = canvas.height = Math.floor(clientHeight * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  setupCursorTrail();
}
window.addEventListener('resize', resize);

sigEl.textContent = MESSAGE;
sigEl.style.opacity = '0';

function lerp(a,b,t){ return a+(b-a)*t; }
function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
function easeInOutCubic(t){ return t<0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2; }
function easeInOutSine(t){ return -(Math.cos(Math.PI*t)-1)/2; }
function easeOutBack(t, s=1.618){ return 1 + (s+1)*Math.pow(t-1,3) + s*Math.pow(t-1,2); }
function easeOutElastic(t){
  const c4 = (2*Math.PI)/3;
  return t===0 ? 0 : t===1 ? 1 : Math.pow(2,-10*t) * Math.sin((t*10-0.75)*c4) + 1;
}
function easeOutBounce(t){
  const n1=7.5625,d1=2.75;
  if (t<1/d1) return n1*t*t;
  if (t<2/d1){ t-=1.5/d1; return n1*t*t+.75; }
  if (t<2.5/d1){ t-=2.25/d1; return n1*t*t+.9375; }
  t-=2.625/d1; return n1*t*t+.984375;
}

// Path for rolling ball
function pathX(t){ return lerp(0.08*W/dpr, 0.92*W/dpr, t); }
function pathY(t){
  const base = 0.64 * H/dpr;
  const amp = Math.min(22, Math.max(12, H/dpr*0.018));
  return base + Math.sin(t*Math.PI*2*1.1) * (amp*0.25);
}

// Trail system
const trail = [];
let lastTrailX = null;
function addTrailPoint(x,y){
  if (lastTrailX !== null && Math.abs(x-lastTrailX) < 1.2) return;
  lastTrailX = x;
  trail.push({x,y});
  if (trail.length>600) trail.shift();
}
function clearTrail(){
  trail.length = 0;
  lastTrailX = null;
}

// Draw trail (soft white only; no dark/black line)
function drawTrail(alpha=1){
  if (trail.length<2) return;
  const glowColor = 'rgba(255,255,255,0.7)';
  const inkColor = getComputedStyle(document.documentElement).getPropertyValue('--trail').trim() || '#ffffff';
  const len = trail.length;

  ctx.save();
  ctx.lineCap='round';
  ctx.lineJoin='round';

  // glow
  ctx.globalAlpha = 0.22*alpha;
  ctx.strokeStyle = glowColor;
  ctx.lineWidth = 9;
  ctx.beginPath();
  for (let i=0;i<len;i++){
    const p=trail[i];
    i===0 ? ctx.moveTo(p.x,p.y) : ctx.lineTo(p.x,p.y);
  }
  ctx.stroke();

  // main soft white line
  ctx.globalAlpha = 1*alpha;
  ctx.strokeStyle = inkColor;
  ctx.beginPath();
  for (let i=0;i<len;i++){
    const p=trail[i];
    i===0 ? ctx.moveTo(p.x,p.y) : ctx.lineTo(p.x,p.y);
  }
  ctx.lineWidth = 3;
  ctx.stroke();

  // rounded head
  const head = trail[len-1];
  ctx.fillStyle = inkColor;
  ctx.beginPath();
  ctx.arc(head.x, head.y, 1.5, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();
}

function positionBall(x,y,rot, sx=1, sy=1){
  ballEl.style.left = x + 'px';
  ballEl.style.top = y + 'px';
  ballEl.style.transform = `translate(-50%,-50%) rotate(${rot}rad) scale(${sx},${sy})`;
}

function positionHeart(x,y,scale=1,opacity=1){
  heartEl.style.left = x + 'px';
  heartEl.style.top = y + 'px';
  heartEl.style.transform = `translate(-50%,-50%) scale(${scale})`;
  heartEl.style.opacity = opacity.toFixed(3);
}

function setSignatureOpacity(o){
  sigEl.style.opacity = o.toFixed(3);
}
function layoutSignature(){
  // Text positioning is now handled by CSS for better centering
}

// Background subtle grain + vignette
function drawBackdrop(){
  const grad = ctx.createRadialGradient((W/dpr)*0.5,(H/dpr)*0.4,20,(W/dpr)*0.5,(H/dpr)*0.5,Math.max(W,H)/dpr);
  grad.addColorStop(0,'rgba(255,255,255,0)');
  grad.addColorStop(1,'rgba(0,0,40,0.06)');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,W/dpr,H/dpr);

  const step = 64;
  ctx.save();
  ctx.globalAlpha = 0.04;
  for (let y=0;y<H;y+=step){
    for (let x=0;x<W;x+=step){
      const n = (Math.sin(x*12.9898 + y*78.233) * 43758.5453);
      const g = Math.abs(n - Math.floor(n));
      ctx.fillStyle = `rgba(0,0,0,${0.015 + g*0.015})`;
      ctx.fillRect(x/dpr, y/dpr, step/dpr, step/dpr);
    }
  }
  ctx.restore();
}

// Timeline state
const T = { start: performance.now() };
let rafId = null;

function loop(now){
  const t = (now - T.start)/1000;

  const tRoll = 3.8;
  const tSettle = 0.6;
  const tMorph = 2.0;
  const tBlend = 1.2;

  const t0 = tRoll;
  const t1 = t0 + tSettle;
  const t2 = t1 + tMorph;
  const t3 = t2 + tBlend;

  ctx.clearRect(0,0,W/dpr,H/dpr);
  drawBackdrop();

  // Phase 0: roll and draw soft trail
  if (t <= t0){
    const k = easeInOutCubic(clamp(t/tRoll,0,1));
    const x = pathX(k);
    const y = pathY(k);
    const r = 18;
    const rot = k * (Math.PI*2*1.9);
    addTrailPoint(x, y + r - 2);
    drawTrail(1);
    positionBall(x,y,rot,1,1);
    ballEl.style.opacity = '1';
    setSignatureOpacity(0);
    positionHeart(x,y,0.2,0);
  }

  // Phase 1: trail settles and fades slightly
  if (t > t0 && t <= t1){
    const ks = easeInOutSine(clamp((t-t0)/tSettle,0,1));
    const bx = pathX(1);
    const by = pathY(1) - ks*8;
    const rot = (Math.PI*2*1.9) + ks*0.4;
    positionBall(bx,by,rot,1 + ks*0.02, 1 - ks*0.02);

    const shift = ks * 10;
    if (trail.length>1){
      ctx.save();
      ctx.translate(0, shift);
      drawTrail(1 - ks*0.85);
      ctx.restore();
    }
    positionHeart(bx,by,0.2,0);
  }

  // Phase 2: show text (no black baseline)
  if (t > t1 && t <= t2){
    const km = easeInOutCubic(clamp((t - t1)/tMorph, 0, 1));
    const bx = pathX(1);
    const by = pathY(1) - 8;
    const rot = (Math.PI*2*2.1);
    positionBall(bx + Math.sin(km*6)*2, by + Math.sin(km*5)*1.5, rot, 1,1);
    ballEl.style.opacity = (1 - km*0.85).toFixed(3);
    setSignatureOpacity(clamp((km-0.15)/0.6,0,1));
    layoutSignature();
  }

  // Phase 3: ball blends to heart (bigger heart)
  if (t > t2 && t <= t3){
    setSignatureOpacity(1);
    layoutSignature();

    const kb = clamp((t - t2)/tBlend, 0, 1);
    const bx = pathX(1);
    const groundY = pathY(1) - 6;

    const squash = 1 + (1 - easeInOutSine(kb)) * 0.28;
    const stretch = 1 / squash;
    const lift = easeOutBounce(kb) * 36;
    const rot = (Math.PI*2*2.2) + kb*0.8;
    positionBall(bx, groundY - lift, rot, 1.0+ (squash-1)*0.6, stretch);
    ballEl.style.opacity = (1 - kb).toFixed(3);

    const hScale = 0.8 + easeOutElastic(kb)*0.9; // increased from 0.6 + *0.6
    positionHeart(bx, groundY - lift + 2, hScale, clamp(kb*1.2,0,1));
  }

  // Phase 4: looping heart pulse (bigger pulse)
  if (t > t3){
    setSignatureOpacity(1);
    layoutSignature();

    const baseX = pathX(1);
    const baseY = pathY(1) - 6;
    const pulseT = (t - t3);
    const s = 1.15 + Math.sin(pulseT*3.0)*0.08 + Math.sin(pulseT*1.4)*0.04; // larger base & amplitude
    const bob = Math.sin(pulseT*2.0)*3.5;
    positionHeart(baseX, baseY + bob, s, 1);
    ballEl.style.opacity = '0';
  }

  // Draw cursor trail
  drawCursorTrail();
  
  rafId = requestAnimationFrame(loop);
}

function resetAndPlay(){
  // reset visuals and state
  clearTrail();
  setSignatureOpacity(0);
  ballEl.style.opacity = '1';
  const x0 = pathX(0);
  const y0 = pathY(0);
  positionBall(x0, y0, 0, 1, 1);
  positionHeart(x0, y0, 0.2, 0);

  // restart timeline
  T.start = performance.now();
}

function init(){
  canvas.style.width = '100%';
  canvas.style.height = '100%';
  resize();

  // Initialize cursor trail
  setupCursorTrail();
  
  const x0 = pathX(0);
  const y0 = pathY(0);
  positionBall(x0, y0, 0,1,1);
  positionHeart(x0, y0, 0.2, 0);
  setSignatureOpacity(0);

  T.start = performance.now();
  rafId = requestAnimationFrame(loop);
  
  // Cursor events
  document.addEventListener('mousemove', updateCursor);
  document.addEventListener('mouseenter', () => cursorEl.style.opacity = '1');
  document.addEventListener('mouseleave', () => cursorEl.style.opacity = '0');

  // Restart on click/tap or key press (Space/Enter)
  const restart = (e) => {
    if (e && e.type === 'keydown') {
      if (!(e.code === 'Space' || e.code === 'Enter')) return;
      e.preventDefault();
    }
    resetAndPlay();
  };
  document.addEventListener('click', restart);
  document.addEventListener('keydown', restart, {passive:false});
}

// Reduced motion
const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
if (prefersReduced){
  T.start = performance.now() - 2000;
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>
</body>
</html> 